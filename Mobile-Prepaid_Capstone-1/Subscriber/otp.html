<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobilePrepaid</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>

    
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="./asserts/logo-finalz.png" alt="Logo" height="50" width="100"> 
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link" href="./index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="./Prepaid.html">Prepaid</a></li>
                    <li class="nav-item">
                        <a class="nav-link text-decoration-none text-reset" href="./index.html#zen">Recharge</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="#">Help</a></li>
                </ul>

                <div class="d-flex align-items-center">
                    <a href="phone.html" class="nav-link text-danger">
                        <i class="bi bi-person"></i>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" fill="black" class="bi bi-person" viewBox="0 0 16 16">
                                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                                      </svg>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <section class="main-section d-flex align-items-center justify-content-center">
        <div class="content-wrapper">
            
            <div class="left-panel">
                <img src="./asserts/photo-otp.png" alt="Side Image">
            </div>

            
            <div class="col-md-6 d-flex align-items-center justify-content-center">
                <div class="card p-4 shadow-sm">
                    <h2 class="text-center">Enter OTP</h2>
                    <form id="otpForm">
                        <div class="d-flex justify-content-center gap-2 my-3">
                            <input type="text" class="otp-input" maxlength="1" id="digit1" required>
                            <input type="text" class="otp-input" maxlength="1" id="digit2" required>
                            <input type="text" class="otp-input" maxlength="1" id="digit3" required>
                            <input type="text" class="otp-input" maxlength="1" id="digit4" required>
                        </div>
                        <button class="btn btn-danger w-100" type="submit">Verify OTP</button>
                    </form>
                    <div id="timer" class="my-3 text-center"></div>
                    <button id="resendButton" class="btn btn-secondary w-100" disabled>Resend OTP</button>
                </div>
            </div>
        </div>
    </section>

    <!-- SweetAlert CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Get stored OTP from localStorage
let storedOtp = localStorage.getItem("otp");

// Selecting elements
const timerElement = document.getElementById("timer");
const resendButton = document.getElementById("resendButton");
const otpInputs = document.querySelectorAll(".otp-input");
const otpForm = document.getElementById("otpForm");
const verifyButton = document.querySelector('button[type="submit"]'); // FIXED: Selecting Verify OTP button

// Initially disable the Verify OTP button
verifyButton.disabled = true;

// Function to check if all OTP fields are filled
function checkOtpFilled() {
    const allFilled = [...otpInputs].every(input => input.value.length === 1);
    verifyButton.disabled = !allFilled; // Enable only when all fields are filled
}

// Event listeners for OTP input fields
otpInputs.forEach(input => {
    input.addEventListener("input", checkOtpFilled);
    input.addEventListener("keydown", checkOtpFilled);
});

let countdown = 10; // Timer duration
resendButton.disabled = true; // Disable resend button initially

// Function to start countdown
function startCountdown() {
    countdown = 10;
    resendButton.disabled = true; // Disable resend button
    timerElement.innerHTML = `Resend OTP in ${countdown} seconds`;

    let timerInterval = setInterval(() => {
        timerElement.innerHTML = `Resend OTP in ${countdown--} seconds`;
        if (countdown < 0) {
            clearInterval(timerInterval);
            resendButton.disabled = false; // Enable resend button
            timerElement.innerHTML = "You can resend OTP now!";
        }
    }, 1000);
}

// Start countdown on page load
startCountdown();

// Auto move to next input
otpInputs.forEach((input, index) => {
    input.addEventListener("input", () => {
        if (input.value.length === 1 && index < otpInputs.length - 1) {
            otpInputs[index + 1].focus();
        }
    });

    input.addEventListener("keydown", (event) => {
        if (event.key === "Backspace" && index > 0 && input.value === "") {
            otpInputs[index - 1].focus();
        }
    });
});

// OTP Form Submission
otpForm.addEventListener("submit", function (event) {
    event.preventDefault();
    const enteredOtp = [...otpInputs].map(input => input.value).join("");
    
    if (parseInt(enteredOtp) === parseInt(storedOtp)) {
        localStorage.setItem("isLoggedIn", "true");

        // âœ… SweetAlert for Success Message
        Swal.fire({
            title: "OTP Verified!",
            text: "Redirecting to your profile...",
            icon: "success",
            timer: 2000,
            showConfirmButton: false
        }).then(() => {
            window.location.href = "Profile.html";
        });

    } else {
        // Create popup message instead of alert
        let errorPopup = document.getElementById("error-popup");
        if (!errorPopup) {
            errorPopup = document.createElement("div");
            errorPopup.id = "error-popup";
            errorPopup.style.color = "red";
            errorPopup.style.marginTop = "10px";
            errorPopup.style.textAlign = "center";
            errorPopup.style.padding = "8px";
            errorPopup.style.borderRadius = "4px";
            errorPopup.style.backgroundColor = "#ffeeee";
            otpForm.appendChild(errorPopup);
        }
        
        // errorPopup.textContent = "Invalid OTP. Try again.";
        errorPopup.innerHTML = `<i class="fas fa-exclamation-circle"></i> Invalid OTP. Try again.`;
errorPopup.style.color = "#d9534f";
errorPopup.style.fontSize = "12px";
        
        // Clear input fields
        otpInputs.forEach(input => input.value = "");
        otpInputs[0].focus();
    }
});

// Resend OTP Functionality
resendButton.addEventListener("click", () => {
    // Generate new OTP (for testing purposes, normally this comes from the server)
    storedOtp = Math.floor(1000 + Math.random() * 9000); // 4-digit OTP
    localStorage.setItem("otp", storedOtp);
    
    // Create popup notification instead of alert
    let otpPopup = document.getElementById("otp-popup");
    if (!otpPopup) {
        otpPopup = document.createElement("div");
        otpPopup.id = "otp-popup";
        otpPopup.style.position = "fixed";
        otpPopup.style.top = "20px";
        otpPopup.style.left = "50%";
        otpPopup.style.transform = "translateX(-50%)";
        otpPopup.style.backgroundColor = "#ffeeee";
        otpPopup.style.color = "#d9534f";
        otpPopup.style.padding = "10px 20px";
        otpPopup.style.borderRadius = "4px";
        otpPopup.style.boxShadow = "0 2px 5px rgba(0,0,0,0.2)";
        otpPopup.style.zIndex = "1000";
        document.body.appendChild(otpPopup);
    }
    
    otpPopup.textContent = `New OTP Sent: ${storedOtp}`; // Remove this in production
    otpPopup.style.display = "block";
    
    // Hide popup after 3 seconds
    setTimeout(() => {
        otpPopup.style.display = "none";
    }, 3000);

    // Clear input fields
    otpInputs.forEach(input => input.value = "");
    otpInputs[0].focus();
    
    // Hide the error message
    const errorPopup = document.getElementById("error-popup");
    if (errorPopup) {
        errorPopup.style.display = "none";
    }

    // Restart the countdown
    startCountdown();
});

    </script>

</body>
</html>
